# 크리투스 팀 랭킹 대시보드 운영 매뉴얼

---

## 1. 시스템 전체 구조

```
[구글 폼]           →  과제 폼 시트 (응답 자동 기록)
[소그룹 배정 시트]   →  팀(톡방) 배정 정보

        ↓ IMPORTRANGE로 연동

[대시보드 스프레드시트]
  ├ "과제 폼 가져오기"     ← 폼 응답 원본
  ├ "소그룹 데이터 가져오기" ← 팀 배정 원본
  └ "점수 집계"           ← 수식으로 자동 계산

        ↓ "웹에 게시" (CSV)

[dashboard/index.html]  →  Vercel 배포  →  공개 URL
```

**핵심 포인트**: 수강생이 구글 폼으로 과제를 제출하면, 스프레드시트 수식이 자동으로 점수를 집계하고, 대시보드가 5분마다 갱신된다. 운영자가 수동으로 할 일은 **피드백 체크박스**뿐이다.

---

## 2. 점수 규칙

### 총점 = 개인점수(F열) + 전원 제출 보너스(G열) + 피드백 보너스(L열)

| 항목 | 점수 | 조건 |
|------|------|------|
| **개인 제출** | 1건당 10점 x (15 / 팀원수) | 마감일 이전에 제출한 건수 기반. 15인 기준 정규화 |
| **전원 제출 보너스** | 주차당 100점 | 해당 주차에 톡방 전원이 과제를 제출했을 때 |
| **피드백 보너스** | 주차당 100점 | 팀 전원이 '#피드백요청'을 톡방에 남기면 운영자가 체크 |

### 정규화 예시 (15인 기준)

- 팀원 15명 → 1건 제출 = 10점
- 팀원 10명 → 1건 제출 = 15점 (인원이 적으면 가중치 높아짐)
- 팀원 20명 → 1건 제출 = 7.5점

> 15는 1기의 기대 평균 팀원수. 팀 규모가 크게 달라지면 F열 수식의 15를 조정할 것.

---

## 3. "점수 집계" 시트 구조

### 데이터 영역 (A~L열)

| 열 | 헤더 | 내용 | 계산 방식 |
|----|------|------|-----------|
| A | 팀 | 팀명 (A~F) | 수동 입력 |
| B | 팀원수 | 소그룹 시트에서 자동 집계 | `=COUNTIFS(소그룹!B:B, A2)` |
| C | 1주차 제출 | 마감 이전 제출 건수 | 수식 (아래 상세) |
| D | 2주차 제출 | 마감 이전 제출 건수 | 수식 (아래 상세) |
| E | 3주차 제출 | 마감 이전 제출 건수 | 수식 (아래 상세) |
| F | 누적 개인 | 개인점수 합계 | `=SUM(C:E) x 10 x (15/B)` |
| G | 누적보너스 | 전원 제출 보너스 | `=COUNTIF(C:E, ">="&B) x 100` |
| H | 총점 | **최종 순위 기준** | `=F + G + L` |
| I | 피드백1주차 | 체크박스 | 운영자가 수동 체크 |
| J | 피드백2주차 | 체크박스 | 운영자가 수동 체크 |
| K | 피드백3주차 | 체크박스 | 운영자가 수동 체크 |
| L | 피드백보너스 | 피드백 점수 합계 | `=COUNTIF(I:K, TRUE) x 100` |

### 설정 영역 (N~O열)

| 셀 | N열 (레이블) | O열 (값) | 설명 |
|----|-------------|---------|------|
| 2행 | 1주차 과제 마감일 | `2026/02/11 23:00:00` | **이 값만 바꾸면 2-3주차 자동 계산** |
| 3행 | 2주차 과제 마감일 | =O2+7 (자동) | |
| 4행 | 3주차 과제 마감일 | =O2+14 (자동) | |
| 6행 | 1주차 중복허용 | 체크박스 (TRUE) | 중복 제출 카운트 여부 |
| 7행 | 2주차 중복허용 | 체크박스 (FALSE) | |
| 8행 | 3주차 중복허용 | 체크박스 (TRUE) | |

---

## 4. 과제 제출 집계 로직 (C~E열 수식)

과제 제출 건수를 세는 핵심 수식이다. "과제 폼 가져오기" 시트의 원본 데이터에서 아래 4가지 조건을 모두 만족하는 행만 카운트한다.

### 공통 조건 (모든 주차)

| 조건 | 의미 | 수식 표현 |
|------|------|-----------|
| 이름 존재 | C열(이름)이 비어있지 않음 | `C열 <> ""` |
| 팀 일치 | E열(톡방 알파벳)이 해당 팀과 일치 | `E열 = $A2` |
| 주차 일치 | F열(주차 텍스트)에 "N주차"가 포함됨 | `SEARCH("N주차", F열)` |
| 마감 이전 | 제출 시각이 마감일 이전 | 아래 참고 |

### 마감 조건의 차이

| 주차 | 마감 조건 | 이유 |
|------|-----------|------|
| **1주차 (C열)** | 제출 당일 23시 이전 (`HOUR(시각+9/24) < 23`) | 1기 데이터 보존을 위해 기존 방식 유지 |
| **2~3주차 (D~E열)** | 설정된 마감일 이전 (`시각+9/24 <= O2+7일`) | 마감일 기반 필터 |

> `+9/24`은 UTC→KST 변환. 원본 폼 시트의 타임존이 UTC(Etc/GMT)로 설정되어 있기 때문.

> **다음 기수 권장**: 1주차도 D~E열과 동일한 마감일 기반 수식으로 통일. 현재는 1기 데이터 정합성 유지를 위해 다르게 운영 중.

### 중복 제출 처리 (2~3주차만)

N6:O8 설정의 체크박스로 주차별로 제어:

- **중복 허용 (TRUE)**: 같은 사람이 여러 번 제출하면 모두 카운트
- **중복 제거 (FALSE)**: 같은 사람은 1번만 카운트 (고유 이름 기준)

---

## 5. 매주 운영자가 할 일

### 피드백 보너스 체크

1. 톡방에서 팀 전원이 '#피드백요청'을 남겼는지 확인
2. "점수 집계" 시트의 **I~K열 체크박스**를 해당 팀/주차에 체크
3. L열(피드백보너스)과 H열(총점)이 자동으로 갱신됨
4. 대시보드는 5분 내 자동 반영

### 중복 제출 토글 (필요 시)

- "점수 집계" 시트의 **O6:O8 체크박스**로 주차별 중복 허용/제거 전환
- 체크하면 중복 허용, 해제하면 중복 제거

> 이 외에 운영자가 수동으로 할 일은 없다. 과제 제출 → 점수 집계 → 대시보드 표시는 모두 자동.

---

## 6. 새 기수 초기 세팅

### 6-1. 전제 조건

| 항목 | 설명 |
|------|------|
| 구글 폼 | 수강생 과제 제출용. 질문 순서: 타임스탬프, (자유), 이름, (자유), 톡방, 주차 |
| 소그룹 배정 시트 | A열: 이름, B열: 톡방 알파벳 |
| Google Sheets API | 서비스 계정 `credentials.json`이 `~/.claude/google-sheets/`에 존재 |
| GitHub/Vercel | `creatus-team` 계정에 연동 |

### 6-2. 세팅 순서

**① 데이터 연동 시트의 IMPORTRANGE 코드 변경**

"과제 폼 가져오기", "소그룹 데이터 가져오기" 시트에 이미 IMPORTRANGE 수식이 들어있다.
새 기수의 원본 시트 코드(스프레드시트 URL의 /d/ 뒤 ID값)만 바꿔주면 된다.

| 시트 | IMPORTRANGE에서 바꿀 부분 |
|------|--------------------------|
| `과제 폼 가져오기` | 원본 스프레드시트 코드 → 새 기수의 과제 폼 시트 코드로 교체 |
| `소그룹 데이터 가져오기` | 원본 스프레드시트 코드 → 새 기수의 소그룹 배정 시트 코드로 교체 |

> 시트 코드 = 스프레드시트 URL에서 /d/ 와 /edit 사이의 긴 문자열

**② "점수 집계" 시트 생성**

Claude Code에게 아래와 같이 요청:
> "대시보드 스프레드시트 ID는 `{새 ID}`야. 점수 집계 시트를 세팅해줘."

`scripts/init_dashboard_sheet.py`의 `SHEET_ID`를 새 값으로 바꾸고 실행하면 헤더, 팀명, 수식, 설정 영역이 모두 자동 생성된다.

**③ "웹에 게시" 설정**

1. 스프레드시트 → 파일 → 공유 → 웹에 게시
2. "전체 문서"를 "CSV" 형식으로 게시

**④ 대시보드 HTML 수정**

`dashboard/index.html` 파일에서 `SHEET_ID` 상수를 새 스프레드시트 ID로 교체.

**⑤ 배포**

```bash
git add index.html && git commit -m "N기 스프레드시트 연결" && git push
```

Vercel이 자동 배포한다. 공개 URL: `https://team-ranking-dashboard.vercel.app`

**⑥ 마감일 설정**

점수 집계 시트의 **O2 셀**에 1주차 마감일을 입력. 2~3주차는 자동 계산.

---

## 7. 트러블슈팅

| 증상 | 확인 사항 |
|------|-----------|
| 대시보드에 데이터가 안 뜸 | "웹에 게시" 설정 확인. 시트 이름에 오타가 없는지 확인 |
| 수식 에러 (#REF!, #VALUE!) | "과제 폼 가져오기", "소그룹 데이터 가져오기" 시트 이름이 정확한지, IMPORTRANGE가 정상 작동하는지 확인 |
| 피드백 보너스 미반영 | I~K열이 체크박스(BOOLEAN 유효성 검사)인지, H열 수식에 `+L2`가 포함되어 있는지 확인 |
| 점수가 이상함 | N~O열 설정 영역의 마감일과 중복 허용 토글 값 확인 |

---

## 부록: 원본 데이터 시트 컬럼 참조

"과제 폼" 시트 (구글 폼 응답 원본):

| 열 | 내용 | 수식에서 사용 |
|----|------|--------------|
| A | 타임스탬프 (UTC) | 마감 판단에 사용 (+9/24로 KST 변환) |
| B | (폼 질문) | 사용 안 함 |
| C | 이름 | 제출자 이름 |
| D | (폼 질문) | 사용 안 함 |
| E | 톡방 알파벳 | 팀 매칭 |
| F | 주차 텍스트 | "N주차" 포함 여부로 주차 판별 |

> 새 구글 폼을 만들 때 질문 순서를 동일하게 유지해야 한다.

# 변경 이력

## 2026-02-18

### v2 대시보드 구현

#### 1. 구글 시트 — 마감일 기반 과제 집계 (D-E열)
- 2~3주차 수식을 `HOUR<23`에서 **마감일 기반 필터**로 변경
- 설정 영역을 N-O열로 이전: O2에 1주차 마감일만 입력하면 2-3주차 자동 계산
- 1주차(C열)는 기존 v1 수식 유지 (1기 데이터 보존)

#### 2. 구글 시트 — 중복 제출 토글 (N6:O8)
- 주차별 중복 허용/제거를 체크박스로 제어
- TRUE: 동일 인물 중복 카운트 (SUMPRODUCT) / FALSE: 고유 이름만 카운트 (UNIQUE+FILTER)
- 기존 9행 체크박스 방식 폐기

#### 3. 구글 시트 — 피드백 보너스 시스템 (I-L열)
- I~K열: 주차별 피드백 체크박스 (운영자가 수동 체크)
- L열: `=COUNTIF(I:K, TRUE)*100` 자동 계산
- H열 총점 수식: `=F+G` → `=F+G+L` (피드백 보너스 포함)

#### 4. 대시보드 UI 변경
- 상세 순위표에 **피드백 보너스** 컬럼 추가 (💬 배지)
- "보너스" → "전체 제출 보너스"로 텍스트 변경
- 바 차트 순위 숫자를 **메달 이모지**로 교체 (🥇🥈🥉)
- 점수 산정 방식에 피드백 보너스 항목 추가
- 주차별 제출 현황을 **알파벳순** 정렬로 변경
- 개인별 제출 현황 렌더링 제거 (추후 구현 예정)

#### 5. CSV 파싱 업데이트
- `fb1`, `fb2`, `fb3`, `fbBonus` 필드 추가 (cells[8]~[11])
- TRUE/FALSE → 0/1 변환
- 필터 조건 강화: `row.members > 0` 추가

#### 6. 운영 매뉴얼 전면 개편
- 기존 매뉴얼 대폭 간소화 (899행 → 164행)
- Python 스크립트 코드, CSS/JS 구현 상세, 수식 원문 제거
- 운영자 관점 필수 정보만 유지: 점수 규칙, 시트 구조, 집계 로직, 운영 방법, 초기 세팅
- 구글 시트에 서식 적용 업로드 (섹션 헤더, 테이블 테두리, 줄무늬, 노트 배경색 등)

#### 7. 배포
- GitHub `creatus-team/team-ranking-dashboard`에 푸시
- Vercel 자동 배포 완료

---

## 2026-02-12

### 대시보드 UI 업데이트

#### 1. 팀별 인원수 표시 추가
- 상세 순위표에 "팀원" 열 추가 (시트 B열 데이터 활용)

#### 2. 점수 산정 방식 안내 섹션 추가
- 상세 순위표 아래에 점수 계산 규칙 3가지 상시 표시
- 개인 제출 기여, 팀원 수 보정, 전원 제출 보너스 안내

#### 3. 주차별 제출 현황 테이블 추가
- 상세 순위표와 점수 안내 사이에 별도 테이블로 배치
- "제출 수/팀원 수" 형식 (예: 12/13)
- 전원 제출 시 파란색 강조
- 제출 데이터 없는 주차는 자동 숨김

#### 4. CSV 파싱 w4 열 제거 (버그 수정)
- 실제 시트에 4주차 열이 없어 인덱스가 밀리던 문제 수정
- 로컬 파일에 남아있던 w4 파싱 코드 제거

---

## 2026-02-11

### 주요 업데이트

#### 1. 오후 11시 이후 제출 제외 수식 적용
- KST 기준 오후 11시(23:00) 이후 제출은 해당 주차 과제로 인정하지 않도록 변경
- 적용 범위: 점수 집계 시트 C2:E7 (1~3주차 제출 수 집계 셀 전체)

#### 2. 수식 방식 변경: COUNTIFS → SUMPRODUCT
- COUNTIFS는 시간 함수(HOUR) 기반 조건을 지원하지 않아 SUMPRODUCT로 전환
- 기존 3가지 조건(이름 비어있지 않음 + 팀 일치 + 주차 일치)에 시간 필터 추가

#### 3. 타임존 불일치 보정
- **발견**: 원본 폼 응답 시트 타임존 = `Etc/GMT` (UTC), 대시보드 시트 타임존 = `Asia/Seoul` (KST)
- IMPORTRANGE는 serial number를 그대로 전달하므로 표시 시간이 UTC 기준이었음
- **해결**: 수식에 `+9/24` 추가하여 타임스탬프를 KST로 변환 후 시간 비교

#### 변경된 수식 (C2 기준)
```
변경 전: =IF(COUNTA('과제 폼 가져오기'!$C$2:$C)=0, 0, COUNTIFS('과제 폼 가져오기'!$C$2:$C, "<>", '과제 폼 가져오기'!$E$2:$E, $A2, '과제 폼 가져오기'!$F$2:$F, "*"&(COLUMN()-2)&"주차*"))

변경 후: =IF(COUNTA('과제 폼 가져오기'!$C$2:$C)=0, 0, SUMPRODUCT(('과제 폼 가져오기'!$C$2:$C<>"")*('과제 폼 가져오기'!$E$2:$E=$A2)*ISNUMBER(SEARCH((COLUMN()-2)&"주차", '과제 폼 가져오기'!$F$2:$F))*(HOUR('과제 폼 가져오기'!$A$2:$A+9/24)<23)))
```

---

## 2026-02-06

### 주요 업데이트

#### 1. 주차별 중복 인정 체크박스 추가
- 스프레드시트 9행에 체크박스 추가 (C9, D9, E9)
- 체크 OFF: 1인 1제출만 인정 (UNIQUE 사용)
- 체크 ON: 중복 제출 모두 인정

#### 2. 4주차 열 제거
- 챌린지 기간 4주, 과제 3회에 맞춰 4주차 컬럼 삭제
- 스프레드시트: 8열 → 7열 구조로 변경
- 대시보드: CSV 파싱 인덱스 수정 (w4 필드 제거)

#### 3. 수식 안정화
- 빈 데이터에서 1이 아닌 0을 반환하도록 수정
- `IF(COUNTA(...)=0, 0, ...)` 조건 추가
- 올바른 시트 이름 참조 (`과제 폼 가져오기`, `소그룹 데이터 가져오기`)

### 이전 업데이트

#### 디자인 변경
- 다크 테마 → 화이트 테마
- 순위별 색상: 1등(진한 파랑) → 꼴등(빨강) 그라데이션
- 제목: "1주 1릴스 챌린지 팀 대항전 점수"

#### IMPORTRANGE 구조
- 기수 교체 시 IMPORTRANGE 소스 ID만 변경하면 됨
- 대시보드 스프레드시트(1dKy)는 영구 유지

---

# 현재 구조 (v2)

## 스프레드시트 (1dKyjPmmqtkPbkPv_ByEgQM6i3JNK2hhQ6Ej9nrQbLJw)

```
시트 목록:
├── 과제 폼 가져오기      ← IMPORTRANGE (기수 스프레드시트 참조)
├── 소그룹 데이터 가져오기  ← IMPORTRANGE (기수 스프레드시트 참조)
├── 점수 집계             ← 대시보드가 읽는 시트
└── 작성 매뉴얼           ← 운영 매뉴얼 (서식 적용)
```

## 점수 집계 시트 레이아웃

```
행 1: 헤더
행 2-7: A~F팀 데이터

데이터 영역 (A~L열):
  A: 팀 | B: 팀원수 | C: 1주차 | D: 2주차 | E: 3주차
  F: 누적 개인 | G: 누적보너스 | H: 총점
  I: 피드백1주차 | J: 피드백2주차 | K: 피드백3주차 | L: 피드백보너스

설정 영역 (N~O열):
  N2:O4 — 마감일 (O2만 입력, 나머지 자동)
  N6:O8 — 중복 허용 토글 (체크박스)
```

## 점수 계산 공식

| 항목 | 공식 |
|------|------|
| 개인 점수 (F) | 제출 수 × 10 × (15 / 팀원수) |
| 전원 제출 보너스 (G) | 전원 제출 주차 × 100 |
| 피드백 보너스 (L) | 피드백 체크 주차 × 100 |
| **총점 (H)** | **F + G + L** |

> 15인 정규화: 팀 인원에 관계없이 전원 제출 시 동일한 개인점수 합(150점)

---

# 트러블슈팅 기록

## FILTER 함수 빈 데이터 문제
**증상**: 과제 제출자 0명인데 1로 표시됨
**원인**: FILTER가 빈 범위에서 예상치 못한 동작
**해결**: `IF(COUNTA(범위)=0, 0, FILTER(...))` 패턴 사용

## CSV 파싱 인덱스 불일치
**증상**: 대시보드에서 점수가 표시되지 않음
**원인**: 스프레드시트 열 구조 변경 후 대시보드 미반영
**해결**: parseCSV 함수의 인덱스를 새 구조에 맞게 수정

## CSV 파싱 w4 열 잔존 (2026-02-12)
**증상**: 대시보드에서 모든 팀 점수가 0점으로 표시
**원인**: 로컬 파일에 w4 파싱 코드가 남아있어 인덱스가 1칸씩 밀림
**해결**: w4 파싱 제거, cells[5]~[7]로 인덱스 복원

## 시트 이름 참조 오류
**증상**: 팀원수 0, #DIV/0! 에러
**원인**: 수식에서 존재하지 않는 시트 이름 참조
**해결**: 실제 시트 이름 확인 후 수식 업데이트

# 변경 이력

## 2026-02-11

### 주요 업데이트

#### 1. 오후 11시 이후 제출 제외 수식 적용
- KST 기준 오후 11시(23:00) 이후 제출은 해당 주차 과제로 인정하지 않도록 변경
- 적용 범위: 점수 집계 시트 C2:E7 (1~3주차 제출 수 집계 셀 전체)

#### 2. 수식 방식 변경: COUNTIFS → SUMPRODUCT
- COUNTIFS는 시간 함수(HOUR) 기반 조건을 지원하지 않아 SUMPRODUCT로 전환
- 기존 3가지 조건(이름 비어있지 않음 + 팀 일치 + 주차 일치)에 시간 필터 추가

#### 3. 타임존 불일치 보정
- **발견**: 원본 폼 응답 시트 타임존 = `Etc/GMT` (UTC), 대시보드 시트 타임존 = `Asia/Seoul` (KST)
- IMPORTRANGE는 serial number를 그대로 전달하므로 표시 시간이 UTC 기준이었음
- **해결**: 수식에 `+9/24` 추가하여 타임스탬프를 KST로 변환 후 시간 비교

#### 변경된 수식 (C2 기준)
```
변경 전: =IF(COUNTA('과제 폼 가져오기'!$C$2:$C)=0, 0, COUNTIFS('과제 폼 가져오기'!$C$2:$C, "<>", '과제 폼 가져오기'!$E$2:$E, $A2, '과제 폼 가져오기'!$F$2:$F, "*"&(COLUMN()-2)&"주차*"))

변경 후: =IF(COUNTA('과제 폼 가져오기'!$C$2:$C)=0, 0, SUMPRODUCT(('과제 폼 가져오기'!$C$2:$C<>"")*('과제 폼 가져오기'!$E$2:$E=$A2)*ISNUMBER(SEARCH((COLUMN()-2)&"주차", '과제 폼 가져오기'!$F$2:$F))*(HOUR('과제 폼 가져오기'!$A$2:$A+9/24)<23)))
```

---

## 2026-02-06

### 주요 업데이트

#### 1. 주차별 중복 인정 체크박스 추가
- 스프레드시트 9행에 체크박스 추가 (C9, D9, E9)
- 체크 OFF: 1인 1제출만 인정 (UNIQUE 사용)
- 체크 ON: 중복 제출 모두 인정

#### 2. 4주차 열 제거
- 챌린지 기간 4주, 과제 3회에 맞춰 4주차 컬럼 삭제
- 스프레드시트: 8열 → 7열 구조로 변경
- 대시보드: CSV 파싱 인덱스 수정 (w4 필드 제거)

#### 3. 수식 안정화
- 빈 데이터에서 1이 아닌 0을 반환하도록 수정
- `IF(COUNTA(...)=0, 0, ...)` 조건 추가
- 올바른 시트 이름 참조 (`과제 폼 가져오기`, `소그룹 데이터 가져오기`)

### 이전 업데이트

#### 디자인 변경
- 다크 테마 → 화이트 테마
- 순위별 색상: 1등(진한 파랑) → 꼴등(빨강) 그라데이션
- 제목: "1주 1릴스 챌린지 팀 대항전 점수"

#### IMPORTRANGE 구조
- 기수 교체 시 IMPORTRANGE 소스 ID만 변경하면 됨
- 대시보드 스프레드시트(1dKy)는 영구 유지

---

# 현재 구조

## 스프레드시트 (1dKyjPmmqtkPbkPv_ByEgQM6i3JNK2hhQ6Ej9nrQbLJw)

```
시트 목록:
├── 과제 폼 가져오기    ← IMPORTRANGE (기수 스프레드시트 참조)
├── 소그룹 데이터 가져오기  ← IMPORTRANGE (기수 스프레드시트 참조)
└── 점수 집계          ← 대시보드가 읽는 시트
```

## 점수 집계 시트 레이아웃

```
행 1: 헤더 (팀, 팀원수, 1주차, 2주차, 3주차, 누적개인, 보너스, 총점)
행 2-7: A~F팀 데이터
행 9: 중복 인정 체크박스 (C9, D9, E9)
```

## 점수 계산 공식

| 항목 | 공식 |
|------|------|
| 개인 점수 | 제출 수 × 10 × (15 / 팀원수) |
| 팀 보너스 | 전원 제출 주차 × 100 |
| 총점 | 누적 개인 + 보너스 |

> 15인 정규화: 팀 인원에 관계없이 전원 제출 시 동일한 개인점수 합(150점)

---

# 개선 제안

## 1. 시트 이름 통일
**문제**: 시트 이름이 여러 번 변경되어 혼란 발생
- `활성 과제` vs `과제 폼 가져오기`
- `활성 소그룹` vs `소그룹 데이터 가져오기`

**제안**: 시트 이름을 명확하게 정하고 문서화
```
추천 네이밍:
- [IMPORT] 과제 폼
- [IMPORT] 소그룹 배정
- 점수 집계
```

## 2. 대시보드-스프레드시트 동기화 자동화
**문제**: 스프레드시트 구조 변경 시 대시보드 코드 수동 수정 필요

**제안**:
- 스프레드시트 컬럼 구조를 헤더에서 동적으로 파싱
- 또는 구조 변경 체크리스트 문서화

## 3. 에러 처리 강화
**문제**: FILTER 함수가 빈 데이터에서 예상치 못한 값 반환

**현재 해결책**: `IF(COUNTA(...)=0, 0, ...)` 래핑
**향후**: 수식 템플릿 문서화하여 재사용

## 4. 기수 교체 프로세스 문서화
**현재**: IMPORTRANGE 소스 ID 수동 변경

**제안 체크리스트**:
1. 새 기수 스프레드시트 생성
2. 서비스 계정에 공유 권한 부여
3. `과제 폼 가져오기` 시트의 IMPORTRANGE ID 변경
4. `소그룹 데이터 가져오기` 시트의 IMPORTRANGE ID 변경
5. IMPORTRANGE 승인 (브라우저에서 #REF! 클릭)
6. 점수 집계 데이터 확인

## 5. 대시보드 기능 확장 (선택)
- 주차별 제출률 그래프
- 개인별 기여도 표시
- 팀 보너스 달성 뱃지
- 실시간 새로고침 인디케이터

---

# 트러블슈팅 기록

## FILTER 함수 빈 데이터 문제
**증상**: 과제 제출자 0명인데 1로 표시됨
**원인**: FILTER가 빈 범위에서 예상치 못한 동작
**해결**: `IF(COUNTA(범위)=0, 0, FILTER(...))` 패턴 사용

## CSV 파싱 인덱스 불일치
**증상**: 대시보드에서 점수가 표시되지 않음
**원인**: 스프레드시트 열 구조 변경 후 대시보드 미반영
**해결**: parseCSV 함수의 인덱스를 새 구조에 맞게 수정

## 시트 이름 참조 오류
**증상**: 팀원수 0, #DIV/0! 에러
**원인**: 수식에서 존재하지 않는 시트 이름 참조
**해결**: 실제 시트 이름 확인 후 수식 업데이트
